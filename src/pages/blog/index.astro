---
import Layout from "../../components/blog/Layout.astro";
import Seo from "../../components/blog/Seo.astro";
import { Image } from "astro:assets"
import { getCollection } from "astro:content";
import {BlogPost, sortPostsByDate, toDateTime, transformBlogPost} from "../../lib/utils";

const posts: BlogPost[] = (
  await getCollection("blog", (post) => import.meta.env.DEV || !!post.data.date)
)
  .map((post) => transformBlogPost(post, Astro.url))
  .sort(sortPostsByDate);
---

<Layout>
  <Seo slot="meta" />

  <div class="max-w-4xl flex flex-col items-center gap-6 mx-auto">
    {
      posts.map((post) => (
        <a
          href={`/blog/${post.slug}`}
          rel="prefetch"
          class="bg-gray-50 dark:bg-gray-800 w-full h-full md:border-x border-y border-gray-400 dark:border-gray-600 md:rounded-lg transition transform hover:scale-105 contain-paint"
        >
          {!!post.data.image && (
            <Image
              src={post.data.image}
              alt={`${post.data.title} header image`}
              class="w-full aspect-[4/1] object-top object-cover"
            />
          )}

          <div class="flex flex-col justify-between w-full h-full px-4 py-2 space-y-4">
            <div class="space-y-4">
              <h1 class="text-lg md:text-xl lg:text-2xl font-semibold">
                {post.data.title}
              </h1>

              <p>{post.data.description}</p>
            </div>

            <div>
              {!post.data.date ? (
                <span class="text-red-500 font-semibold uppercase italic">
                  Draft
                </span>
              ) : (
                <time class="text-gray-400" datetime={post.data.date!.toISO()}>
                  {post.data.date!.toFormat("MMMM dd, y")}
                </time>
              )}
            </div>
          </div>
        </a>
      ))
    }
  </div>
</Layout>
